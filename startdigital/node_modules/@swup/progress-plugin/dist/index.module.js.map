{"version":3,"file":"index.module.js","sources":["../src/ProgressBar.js","../src/index.js"],"sourcesContent":["export default class ProgressBar {\n\tstyleElement = null;\n\tprogressElement = null;\n\n\tvalue = 0;\n\tvisible = false;\n\thiding = false;\n\ttrickleInterval = null;\n\n\tconstructor({\n\t\tclassName = 'progress-bar',\n\t\tstyleAttr = 'data-progressbar-styles',\n\t\tanimationDuration = 300,\n\t\tminValue = 0.1,\n\t\tinitialValue = 0.25,\n\t\ttrickleValue = 0.03\n\t} = {}) {\n\t\tthis.className = className;\n\t\tthis.styleAttr = styleAttr;\n\t\tthis.animationDuration = animationDuration;\n\t\tthis.minValue = minValue;\n\t\tthis.initialValue = initialValue;\n\t\tthis.trickleValue = trickleValue;\n\n\t\tthis.styleElement = this.createStyleElement();\n\t\tthis.progressElement = this.createProgressElement();\n\t}\n\n\tget defaultStyles() {\n\t\treturn `\n\t\t.${this.className} {\n\t\t\t\tposition: fixed;\n\t\t\t\tdisplay: block;\n\t\t\t\ttop: 0;\n\t\t\t\tleft: 0;\n\t\t\t\theight: 3px;\n\t\t\t\tbackground-color: black;\n\t\t\t\tz-index: 9999;\n\t\t\t\ttransition:\n\t\t\t\t\twidth ${this.animationDuration}ms ease-out,\n\t\t\t\t\topacity ${this.animationDuration / 2}ms ${this.animationDuration / 2}ms ease-in;\n\t\t\t\ttransform: translate3d(0, 0, 0);\n\t\t\t}\n\t\t`;\n\t}\n\n\tshow() {\n\t\tif (!this.visible) {\n\t\t\tthis.visible = true;\n\t\t\tthis.installStyleElement();\n\t\t\tthis.installProgressElement();\n\t\t\tthis.startTrickling();\n\t\t}\n\t}\n\n\thide() {\n\t\tif (this.visible && !this.hiding) {\n\t\t\tthis.hiding = true;\n\t\t\tthis.fadeProgressElement(() => {\n\t\t\t\tthis.uninstallProgressElement();\n\t\t\t\tthis.stopTrickling();\n\t\t\t\tthis.visible = false;\n\t\t\t\tthis.hiding = false;\n\t\t\t});\n\t\t}\n\t}\n\n\tsetValue(value) {\n\t\tthis.value = Math.min(1, Math.max(this.minValue, value));\n\t\tthis.refresh();\n\t}\n\n\t// Private\n\n\tinstallStyleElement() {\n\t\tdocument.head.insertBefore(this.styleElement, document.head.firstChild);\n\t}\n\n\tinstallProgressElement() {\n\t\tthis.progressElement.style.width = '0%';\n\t\tthis.progressElement.style.opacity = '1';\n\t\tdocument.documentElement.insertBefore(this.progressElement, document.body);\n\t\tthis.progressElement.scrollTop = 0; // Force reflow to ensure initial style takes effect\n\t\tthis.setValue(Math.random() * this.initialValue);\n\t}\n\n\tfadeProgressElement(callback) {\n\t\tthis.progressElement.style.opacity = '0';\n\t\tsetTimeout(callback, this.animationDuration * 1.5);\n\t}\n\n\tuninstallProgressElement() {\n\t\tif (this.progressElement.parentNode) {\n\t\t\tdocument.documentElement.removeChild(this.progressElement);\n\t\t}\n\t}\n\n\tstartTrickling() {\n\t\tif (!this.trickleInterval) {\n\t\t\tthis.trickleInterval = window.setInterval(this.trickle, this.animationDuration);\n\t\t}\n\t}\n\n\tstopTrickling() {\n\t\twindow.clearInterval(this.trickleInterval);\n\t\tdelete this.trickleInterval;\n\t}\n\n\ttrickle = () => {\n\t\tconst advance = Math.random() * this.trickleValue;\n\t\tthis.setValue(this.value + advance);\n\t};\n\n\trefresh() {\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.progressElement.style.width = `${this.value * 100}%`;\n\t\t});\n\t}\n\n\tcreateStyleElement() {\n\t\tconst element = document.createElement('style');\n\t\telement.setAttribute(this.styleAttr, '');\n\t\telement.textContent = this.defaultStyles;\n\t\treturn element;\n\t}\n\n\tcreateProgressElement() {\n\t\tconst element = document.createElement('div');\n\t\telement.className = this.className;\n\t\treturn element;\n\t}\n}\n","import Plugin from '@swup/plugin';\nimport ProgressBar from './ProgressBar';\n\nexport default class SwupProgressPlugin extends Plugin {\n\tname = 'SwupProgressPlugin';\n\n\tconstructor(options = {}) {\n\t\tsuper();\n\t\tconst defaultOptions = {\n\t\t\tclassName: 'swup-progress-bar',\n\t\t\tdelay: 300,\n\t\t\ttransition: undefined,\n\t\t\tminValue: undefined,\n\t\t\tinitialValue: undefined,\n\t\t\thideImmediately: true\n\t\t};\n\n\t\tthis.options = {\n\t\t\t...defaultOptions,\n\t\t\t...options\n\t\t};\n\n\t\tthis.showProgressBarTimeout = null;\n\t\tthis.hideProgressBarTimeout = null;\n\n\t\tthis.progressBar = new ProgressBar({\n\t\t\tclassName: this.options.className,\n\t\t\tanimationDuration: this.options.transition,\n\t\t\tminValue: this.options.minValue,\n\t\t\tinitialValue: this.options.initialValue\n\t\t});\n\t}\n\n\tmount() {\n\t\tthis.swup.on('transitionStart', this.startShowingProgress);\n\t\tthis.swup.on('contentReplaced', this.stopShowingProgress);\n\t}\n\n\tunmount() {\n\t\tthis.swup.off('transitionStart', this.startShowingProgress);\n\t\tthis.swup.off('contentReplaced', this.stopShowingProgress);\n\t}\n\n\tstartShowingProgress = () => {\n\t\tthis.progressBar.setValue(0);\n\t\tthis.showProgressBarAfterDelay();\n\t};\n\n\tstopShowingProgress = () => {\n\t\tthis.progressBar.setValue(1);\n\t\tif (this.options.hideImmediately) {\n\t\t\tthis.hideProgressBar();\n\t\t} else {\n\t\t\tthis.finishAnimationAndHideProgressBar();\n\t\t}\n\t};\n\n\tshowProgressBar = () => {\n\t\tthis.cancelHideProgressBarTimeout();\n\t\tthis.progressBar.show();\n\t};\n\n\tshowProgressBarAfterDelay = () => {\n\t\tthis.cancelShowProgressBarTimeout();\n\t\tthis.cancelHideProgressBarTimeout();\n\t\tthis.showProgressBarTimeout = window.setTimeout(this.showProgressBar, this.options.delay);\n\t};\n\n\thideProgressBar = () => {\n\t\tthis.cancelShowProgressBarTimeout();\n\t\tthis.progressBar.hide();\n\t};\n\n\tfinishAnimationAndHideProgressBar = () => {\n\t\tthis.cancelShowProgressBarTimeout();\n\t\tthis.hideProgressBarTimeout = window.setTimeout(this.hideProgressBar, this.options.transition);\n\t};\n\n\tcancelShowProgressBarTimeout = () => {\n\t\twindow.clearTimeout(this.showProgressBarTimeout);\n\t\tdelete this.showProgressBarTimeout;\n\t};\n\n\tcancelHideProgressBarTimeout = () => {\n\t\twindow.clearTimeout(this.hideProgressBarTimeout);\n\t\tdelete this.hideProgressBarTimeout;\n\t};\n}\n"],"names":["ProgressBar","constructor","_temp","className","styleAttr","animationDuration","minValue","initialValue","trickleValue","this","styleElement","progressElement","value","visible","hiding","trickleInterval","trickle","advance","Math","random","setValue","createStyleElement","createProgressElement","defaultStyles","show","installStyleElement","installProgressElement","startTrickling","hide","fadeProgressElement","uninstallProgressElement","stopTrickling","min","max","refresh","document","head","insertBefore","firstChild","style","width","opacity","documentElement","body","scrollTop","callback","setTimeout","parentNode","removeChild","window","setInterval","clearInterval","requestAnimationFrame","element","createElement","setAttribute","textContent","SwupProgressPlugin","Plugin","options","super","name","startShowingProgress","progressBar","showProgressBarAfterDelay","stopShowingProgress","hideImmediately","hideProgressBar","finishAnimationAndHideProgressBar","showProgressBar","cancelHideProgressBarTimeout","cancelShowProgressBarTimeout","showProgressBarTimeout","delay","hideProgressBarTimeout","transition","clearTimeout","undefined","mount","swup","on","unmount","off"],"mappings":"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"}